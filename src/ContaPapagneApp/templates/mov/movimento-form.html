<style>
	.tags-look .tagify__dropdown__item{
			display: inline-block;
			vertical-align: middle;
			border-radius: 3px;
			padding: .3em .5em;
			border: 1px solid #CCC;
			background: #F3F3F3;
			margin: .2em;
			font-size: .85em;
			color: black;
			transition: 0s;
	}
	
	.tags-look .tagify__dropdown__item--active{
			color: black;
	}
	
	.tags-look .tagify__dropdown__item:hover{
			background: lightyellow;
			border-color: gold;
	}
	
	.tags-look .tagify__dropdown__item--hidden {
			max-width: 0;
			max-height: initial;
			padding: .3em 0;
			margin: .2em 0;
			white-space: nowrap;
			text-indent: -20px;
			border: 0;
	}
	</style>


<style>


	/* CSS toggle slider */
	/* The switch - the box around the slider */
	.switch {
		position: relative;
		display: inline-block;
		width: 60px;
		height: 34px;
	}

	/* Hide default HTML checkbox */
	.switch input {
		opacity: 0;
		width: 0;
		height: 0;
	}

	/* The slider */
	.slider {
		position: absolute;
		cursor: pointer;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: #e49504;
		-webkit-transition: .4s;
		transition: .4s;
	}

	.slider:before {
		position: absolute;
		content: "";
		height: 26px;
		width: 26px;
		left: 4px;
		bottom: 4px;
		background-color: white;
		-webkit-transition: .4s;
		transition: .4s;
	}

	input:checked+.slider {
		background-color: #2196F3;
	}

	input:focus+.slider {
		box-shadow: 0 0 1px #2196F3;
	}

	input:checked+.slider:before {
		-webkit-transform: translateX(26px);
		-ms-transform: translateX(26px);
		transform: translateX(26px);
	}

	/* Rounded sliders */
	.slider.round {
		border-radius: 34px;
	}

	.slider.round:before {
		border-radius: 50%;
	}
</style>

<form id="movimento-form" hx-post="{{url_for('movimenti.createMovimento')}}" hx-target="main"> 

	<fieldset class="mb-3"> 
			<legend class="h5">Tipo di Movimento</legend>
			<div class="form-check form-switch">
					<input class="form-check-input" id="tipologia_movimento" name="tipologia_movimento" type="checkbox" value="true" onchange="switchTipoMovimento()">
					<label class="form-check-label" for="tipologia_movimento">USCITA / ENTRATA</label>
			</div>
	</fieldset>

	<div class="form-row mb-3">
			<div class="form-group col-md-6">
					<label for="data_movimento" >Data:</label> 
					<input class="form-control" id="data_movimento" name="data_movimento" type="date" placeholder="Data Movimento" required>
			</div>
			<div class="form-group col-md-6">
					<label for="importo_movimento">Importo:</label>
					<div class="input-group"> 
							<div class="input-group-prepend">
									<span class="input-group-text">â‚¬</span> 
							</div>
							<input class="form-control" id="importo_movimento" name="importo_movimento" type="number" min="0" step="0.01" placeholder="0.00" required>
					</div>    
			</div>
	</div>

	<div class="form-group mb-3"> 
		<label for="categoria_movimento">Categoria:</label>
		<div class="input-group"> 
				<input class="form-control some_class_name" id="categoria_movimento" name="categoria_movimento" type="text"
						hx-get="/movimenti/fetchCategorie" hx-target="#res_fetch" hx-swap="innerHTML"
						hx-trigger="keyup changed delay:500ms" hx-indicator="#fetch-indicator" required placeholder='write some tags'>
				<div id="res_fetch" class="autocomplete-results"></div>
		</div>
</div>

	<div class="form-group mb-3">
			<label for="risarcimento_movimento">Risarcimento:</label>
			<input class="form-control" id="risarcimento_movimento" name="risarcimento_movimento" type="text" placeholder="Importo Risarcimento" disabled>
			<small class="form-text text-muted" id="risarcimentoHelp">Compilare solo se applicabile.</small> 
	</div> 

	<div class="form-group mb-4">
			<label for="descrizione_movimento">Descrizione:</label>
			<textarea class="form-control" id="descrizione_movimento" name="descrizione_movimento" placeholder="Note Aggiuntive" rows="3"></textarea>
	</div> 

	<button type="submit" class="btn btn-primary btn-lg">Registra</button> 
</form>


<script>
	document.addEventListener("DOMContentLoaded", function() {
			var input = document.querySelector('input[name="categoria_movimento"]');
			var tagify = new Tagify(input, {
					maxTags: 10,
					dropdown: {
							maxItems: 20, 
							classname: "tags-look", 
							enabled: 0, 
							closeOnSelect: false 
					}
			});
	
			
			function updateWhitelistAndShowDropdown(data) {
					tagify.settings.whitelist = data; 
					tagify.dropdown.show.call(tagify);
			}
	
			input.addEventListener('input', function(e) {
					var searchVal = e.target.value;
					if(searchVal.length > 1) { 
							fetch('/movimenti/fetchCategorie?categoria_movimento=' + encodeURIComponent(searchVal))
									.then(response => response.json())
									.then(data => {
											updateWhitelistAndShowDropdown(data); 
									})
									.catch(error => console.error('Error fetching categories:', error));
					}
			});
	});
	</script>
	